{% extends "conteudo-base.html" %}

{% block title %}Módulo 1: Introdução ao PC{% endblock %}

{% block content_title %}Módulo 1: Introdução ao Pensamento Computacional{% endblock %}

{% block content %}
    <div class="content-section">
        <h2 class="text-2xl font-semibold text-primary-indigo mb-4 flex items-center">
            <i class="fas fa-video mr-3"></i> Vídeo Aula: O que é Pensamento Computacional?
        </h2>
        <div class="video-container">
            <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
        </div>
        <p class="text-gray-500 mt-4">Assista e descubra como o PC pode transformar sua prática pedagógica.</p>
    </div>

    <div class="content-section">
        <h2 class="text-2xl font-semibold text-primary-indigo mb-4 flex items-center">
            <i class="fas fa-file-alt mr-3"></i> Material de Apoio (PDF)
        </h2>
        <p class="text-gray-700 mb-4">Baixe o nosso guia rápido para aprofundar os conceitos básicos deste módulo.</p>
        <a href="#" class="bg-secondary-green hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg inline-flex items-center transition duration-200">
            <i class="fas fa-download mr-2"></i> Baixar Guia de Introdução
        </a>
    </div>

    <div class="content-section">
        <h2 class="text-2xl font-semibold text-primary-indigo mb-4 flex items-center">
            <i class="fas fa-clipboard-check mr-3"></i> Exercícios de Fixação
        </h2>
        <div class="space-y-6">
            
            <div id="q-mod0-1" class="border p-4 rounded-lg bg-white shadow">
                <p class="font-semibold text-sm mb-2 text-gray-500">CESGRANRIO - 2024</p>
                <p class="font-semibold text-lg mb-4 text-gray-800">1. Um dos desafios enfrentados pelas organizações no século XXI é a crescente complexidade dos problemas que lhes são apresentados. Uma opção para que as organizações possam ser eficientes e eficazes é a utilização do pensamento computacional, por suas características peculiares. O pensamento computacional caracteriza-se pela(o)</p>
                <div class="space-y-2">
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-1', this, 'true', '✅ Correto! O PC é uma forma de pensar, que utiliza o raciocínio recursivo e heurístico na resolução de problemas complexos, e não se limita a linguagens de programação ou a passos mecânicos.')" data-correct="true">
                        A) Pensamento recursivo, pelo pensamento orientado à mitigação de problemas e pelo uso do raciocínio heurístico na busca de uma solução.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-1', this, 'false', '❌ Incorreto. Essa alternativa reduz ou distorce o conceito; o PC é mais amplo e abrange habilidades aplicáveis além da programação, além de usar múltiplos níveis de abstração.')" data-correct="false">
                        B) Conceitualização, ou seja, por adotar as especificações utilizadas na codificação de um programa de computador, com base em apenas um nível de abstração, para a resolução do problema apresentado.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-1', this, 'false', '❌ Incorreto. O PC é um conjunto de habilidades de pensamento e não se resume à capacidade de seguir instruções de forma mecanizada.')" data-correct="false">
                        C) Habilidade para seguir, de forma mecanizada, as especificações explicitadas nas rotas e nos protocolos de solução para o problema apresentado.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-1', this, 'false', '❌ Incorreto. O PC é mais amplo do que o tratamento puramente matemático e é aplicado em diversos contextos, não apenas em questões isoladas.')" data-correct="false">
                        D) Isolamento das questões referentes ao problema apresentado e tratamento puramente matemático dessas questões.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-1', this, 'false', '❌ Incorreto. O PC é uma forma de pensar, e não envolve diretamente a utilização da forma binária de tratamento de dados pelo ser humano.')" data-correct="false">
                        E) Promoção, no ser humano, de um modo de pensamento similar ao de computadores, pela utilização da forma binária de tratamento de dados na resolução do problema apresentado.
                    </div>
                </div>
                <div class="feedback-message mt-4 hidden"></div>
            </div>
            
            <div id="q-mod0-2" class="border p-4 rounded-lg bg-white shadow">
                <p class="font-semibold text-sm mb-2 text-gray-500">IADES - 2022</p>
                
                <p class="font-semibold text-lg mb-4 text-gray-800">2. Segundo o texto apresentado, Wing destacou algumas ferramentas com o objetivo de resolver problemas de forma eficiente e criativa. Assinale a alternativa que corresponde a algumas dessas ferramentas mentais.</p>

                <div class="mb-4 p-2 border rounded-lg bg-gray-50">
                    <img src="{{ url_for('static', filename='img/IADES-2022.png') }}" alt="Texto de suporte para a Questão 2 (IADES) sobre as ferramentas mentais de Jeannette Wing." class="w-full h-auto max-h-96 object-contain mx-auto rounded-lg">
                </div>

                <div class="space-y-2">
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-2', this, 'false', '❌ Incorreto. Embora úteis, estas são habilidades acadêmicas, não as ferramentas mentais centrais do Pensamento Computacional.')" data-correct="false">
                        A) Conhecimento algébrico e estatístico
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-2', this, 'true', '✅ Correto! A Abstração é um dos pilares de Wing, e a Reformulação do Problema (Decomposição) é o primeiro passo para o Pensamento Computacional.')" data-correct="true">
                        B) Reformulação do problema e abstração
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-2', this, 'false', '❌ Incorreto. Estas são habilidades de desenvolvimento de software (codificação), não as ferramentas conceituais de pensamento.')" data-correct="false">
                        C) Depuração e habilidade com compiladores
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-2', this, 'false', '❌ Incorreto. O PC abrange o pensamento matemático, mas é mais focado em decomposição, padrões e abstração.')" data-correct="false">
                        D) Habilidade com programação e pensamento matemático
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-2', this, 'false', '❌ Incorreto. Topologia não é uma ferramenta central do Pensamento Computacional; os pilares são Decomposição, Reconhecimento de Padrões, Abstração e Algoritmos.')" data-correct="false">
                        E) Decomposição e topologia
                    </div>
                </div>
                <div class="feedback-message mt-4 hidden"></div>
            </div>

            <div id="q-mod0-3" class="border p-4 rounded-lg bg-white shadow">
                <p class="font-semibold text-lg mb-4 text-gray-800">3. Na perspectiva de Wing (2006), o Pensamento Computacional se distingue porque:</p>
                <div class="space-y-2">
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-3', this, 'false', '❌ Incorreto: Ele não é uma técnica de programação, mas uma forma de raciocínio aplicável à vida e ao ensino.')" data-correct="false">
                        A) Envolve apenas abstração e algoritmos.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-3', this, 'false', '❌ Incorreto: Ele não é uma técnica de programação, mas uma forma de raciocínio aplicável à vida e ao ensino.')" data-correct="false">
                        B) Substitui o raciocínio humano por processos automatizados.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-3', this, 'true', '✅ Perfeito! Wing descreve o Pensamento Computacional como uma maneira de aplicar princípios da computação em qualquer domínio.')" data-correct="true">
                        C) Transfere para o cotidiano o modo de pensar usado na computação.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-3', this, 'false', '❌ Incorreto: Ele não é uma técnica de programação, mas uma forma de raciocínio aplicável à vida e ao ensino.')" data-correct="false">
                        D) Limita-se à decomposição de problemas.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-3', this, 'false', '❌ Incorreto: Ele não é uma técnica de programação, mas uma forma de raciocínio aplicável à vida e ao ensino.')" data-correct="false">
                        E) Prioriza a automação de tarefas.
                    </div>
                </div>
                <div class="feedback-message mt-4 hidden"></div>
            </div>

            <div id="q-mod0-4" class="border p-4 rounded-lg bg-white shadow">
                <p class="font-semibold text-lg mb-4 text-gray-800">4. A aplicação do Pensamento Computacional na educação contribui para:</p>
                <div class="space-y-2">
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-4', this, 'false', '❌ Incorreto: Pensar computacionalmente é refletir sobre o processo, não apenas seguir instruções.')" data-correct="false">
                        A) Reduzir a necessidade de pensamento crítico.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-4', this, 'false', '❌ Incorreto: Pensar computacionalmente é refletir sobre o processo, não apenas seguir instruções.')" data-correct="false">
                        B) Estimular memorização e repetição de conteúdos.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-4', this, 'true', '✅ Exatamente! Ele favorece autonomia e protagonismo na aprendizagem.')" data-correct="true">
                        C) Desenvolver autonomia intelectual e resolução criativa de problemas.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-4', this, 'false', '❌ Incorreto: Pensar computacionalmente é refletir sobre o processo, não apenas seguir instruções.')" data-correct="false">
                        D) Substituir o professor por ferramentas digitais.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-4', this, 'false', '❌ Incorreto: Pensar computacionalmente é refletir sobre o processo, não apenas seguir instruções.')" data-correct="false">
                        E) Ensinar apenas conceitos tecnológicos.
                    </div>
                </div>
                <div class="feedback-message mt-4 hidden"></div>
            </div>

            <div id="q-mod0-5" class="border p-4 rounded-lg bg-white shadow">
                <p class="font-semibold text-lg mb-4 text-gray-800">5. Na formação docente, o Pensamento Computacional deve ser entendido como:</p>
                <div class="space-y-2">
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-5', this, 'false', '❌ Incorreto: O Pensamento Computacional é uma abordagem pedagógica que apoia todas as áreas.')" data-correct="false">
                        A) Um conteúdo isolado da prática pedagógica.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-5', this, 'false', '❌ Incorreto: O Pensamento Computacional é uma abordagem pedagógica que apoia todas as áreas.')" data-correct="false">
                        B) Um recurso complementar sem relevância.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-5', this, 'true', '✅ Exato! Ele atua como eixo metodológico para promover raciocínio lógico e resolução criativa.')" data-correct="true">
                        C) Um eixo metodológico para promover raciocínio lógico e resolução criativa.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-5', this, 'false', '❌ Incorreto: O Pensamento Computacional é uma abordagem pedagógica que apoia todas as áreas.')" data-correct="false">
                        D) Uma ferramenta para substituir o planejamento didático.
                    </div>
                    <div class="quiz-option bg-gray-100 p-3 rounded-lg cursor-pointer hover:bg-gray-200"
                        onclick="checkAnswer('q-mod0-5', this, 'false', '❌ Incorreto: O Pensamento Computacional é uma abordagem pedagógica que apoia todas as áreas.')" data-correct="false">
                        E) Um conceito voltado apenas à robótica.
                    </div>
                </div>
                <div class="feedback-message mt-4 hidden"></div>
            </div>


        </div>
    </div>

    <div class="content-section border-4 border-indigo-200 bg-indigo-50">
        <h2 class="text-2xl font-semibold text-primary-indigo mb-4 flex items-center">
            <i class="fas fa-lightbulb mr-3"></i> Questão de Projeto - Fase 1: Escopo Inicial
        </h2>
        <p class="text-gray-700 mb-4">Neste módulo, defina o escopo do seu Projeto Educacional de Pensamento Computacional. As respostas serão salvas para o seu projeto final.</p>
        <form id="project-form-1">
            <div class="mb-4">
                <label for="project_name" class="block text-gray-800 font-medium mb-2">Nome do Projeto Educacional:</label>
                <input type="text" id="project_name" name="project_name" class="w-full p-3 border border-indigo-300 rounded-lg focus:ring-primary-indigo focus:border-primary-indigo" placeholder="Ex: Aventura do Algoritmo em Sala de Aula">
            </div>

            <div class="mb-4">
                <label for="objetivo_geral" class="block text-gray-800 font-medium mb-2">Objetivo Geral:</label>
                <textarea id="objetivo_geral" name="objetivo_geral" rows="3" class="w-full p-3 border border-indigo-300 rounded-lg focus:ring-primary-indigo focus:border-primary-indigo" placeholder="Descreva o que o projeto pretende alcançar."></textarea>
            </div>

            <div class="mb-4">
                <label for="publico_alvo" class="block text-gray-800 font-medium mb-2">Público-Alvo:</label>
                <input type="text" id="publico_alvo" name="publico_alvo" class="w-full p-3 border border-indigo-300 rounded-lg focus:ring-primary-indigo focus:border-primary-indigo" placeholder="Ex: Alunos do 6º ano do Ensino Fundamental.">
            </div>

            <div class="mb-4">
                <label for="justificativa" class="block text-gray-800 font-medium mb-2">Justificativa:</label>
                <textarea id="justificativa" name="justificativa" rows="5" class="w-full p-3 border border-indigo-300 rounded-lg focus:ring-primary-indigo focus:border-primary-indigo" placeholder="Por que este projeto é importante para o público-alvo e para a disciplina?"></textarea>
            </div>

            <div id="project-feedback" class="mt-4 text-sm font-medium text-gray-600 hidden"></div>
            <button type="submit" class="mt-4 bg-primary-indigo hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200">Salvar Fase 1 do Projeto</button>
        </form>
    </div>

    <script>
        // Esta lógica DEVE usar as variáveis e a inicialização que foram definidas no conteudo-base.html

        // Acessa as variáveis globais definidas no conteudo-base.html
        // isFirebaseReady e a instância 'firebase' (v8) são acessíveis aqui.

        const PROJECT_COLLECTION = 'project_data';
        const DOCUMENT_ID = 'main_project';

        function getProjectDocRef(uid, appId) {
            // Caminho: artifacts/{appId}/users/{uid}/project_data/main_project
            return firebase.firestore().collection('artifacts').doc(appId)
                       .collection('users').doc(uid)
                       .collection(PROJECT_COLLECTION).doc(DOCUMENT_ID);
        }

        /**
         * Salva os dados do projeto no Firestore.
         * Esta função só é chamada após a autenticação.
         */
        async function saveProjectData(data) {
            // Usa as variáveis globais (userId, APP_ID) que o 'conteudo-base.html' deve ter definido.
            const userId = firebase.auth().currentUser?.uid;
            // O APP_ID é acessado do contexto global do Flask se estiver configurado corretamente
            const appId = typeof __app_id !== 'undefined' ? __app_id : 'prod'; 
            
            const feedbackEl = document.getElementById('project-feedback');
            
            // VERIFICAÇÃO CRÍTICA (Linha que estava causando o erro)
            if (!userId) {
                console.error("Firebase ou userId não estão prontos. Não foi possível salvar.");
                feedbackEl.textContent = "❌ Erro: O usuário não está autenticado. Recarregue a página.";
                feedbackEl.classList.remove('hidden', 'text-green-500');
                feedbackEl.classList.add('text-red-500');
                return;
            }

            try {
                const docRef = getProjectDocRef(userId, appId);
                // set com { merge: true }
                await docRef.set(data, { merge: true }); 
                
                feedbackEl.textContent = "✅ Projeto da Fase 1 salvo com sucesso!";
                feedbackEl.classList.remove('hidden', 'text-red-500');
                feedbackEl.classList.add('text-green-500');
            } catch (error) {
                console.error("Erro ao salvar dados do projeto:", error);
                feedbackEl.textContent = "❌ Erro ao salvar o projeto. Tente novamente.";
                feedbackEl.classList.remove('hidden', 'text-green-500');
                feedbackEl.classList.add('text-red-500');
            }
        }

        /**
         * Carrega os dados do projeto.
         * É chamada automaticamente após a autenticação bem-sucedida (listener).
         */
        async function loadProjectData(userId, appId) {
            if (!userId) return; // Não faz nada se o ID não estiver disponível

            try {
                const docRef = getProjectDocRef(userId, appId);
                const docSnap = await docRef.get(); // get() na v8

                if (docSnap.exists) {
                    const data = docSnap.data();
                    // Carrega dados usando os nomes de campo padronizados
                    document.getElementById('project_name').value = data.project_name || '';
                    document.getElementById('objetivo_geral').value = data.objetivo_geral || '';
                    document.getElementById('publico_alvo').value = data.publico_alvo || '';
                    document.getElementById('justificativa').value = data.justificativa || '';
                    console.log("Dados do projeto carregados:", data);
                }
            } catch (error) {
                console.error("Erro ao carregar dados do projeto:", error);
            }
        }
        
        // --------------------------------------------------
        // REGISTRO DE EVENTOS (CRÍTICO)
        // --------------------------------------------------

        // Ouve o evento disparado no 'conteudo-base.html' após a autenticação do Firebase.
        document.addEventListener('firebaseAuthReady', function(e) {
            const userId = e.detail.userId;
            const appId = e.detail.appId;
            console.log("Evento firebaseAuthReady recebido no introducao.html. Tentando carregar dados.");
            loadProjectData(userId, appId);
        });

        // Listener do formulário de salvamento
        document.getElementById('project-form-1').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!window.isFirebaseReady) { // isFirebaseReady definida no base.html
                 alert("Aguarde a conexão com o servidor ser estabelecida. Tente novamente em instantes.");
                 return;
            }
            
            // Dados enviados com nomes de campo padronizados
            const data = {
                project_name: document.getElementById('project_name').value,
                objetivo_geral: document.getElementById('objetivo_geral').value,
                publico_alvo: document.getElementById('publico_alvo').value,
                justificativa: document.getElementById('justificativa').value,
                timestamp_m1: new Date().toISOString() // Adiciona um timestamp de salvamento
            };
            saveProjectData(data);
        });
        
        // Mantém a função checkAnswer, mas deve usar a versão do conteudo-base.html
        // (Se houver duplicidade, a última função definida no escopo global prevalece)
        // No seu caso, a função checkAnswer NO BASE.HTML deve ser a que tem a lógica de styling
        // E o onclick nos botões deve ser ajustado para passar 'true'/'false' como string.
        // Já ajustado acima.
        
    </script>
{% endblock %}

{% block finish_button %}
    <div class="mt-8 text-center">
        <form method="POST" action="{{ url_for('concluir_modulo', modulo_nome='introducao') }}">
            <button type="submit" class="btn-finish hover:shadow-lg">
                <i class="fas fa-check-double mr-2"></i>Próximo Módulo
            </button>
        </form>
    </div>
{% endblock %}
